<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finallica Documentation System</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">
                    <span class="logo-icon">‚óà</span>
                    Finallica
                    <span class="logo-subtitle">Documentation System</span>
                </h1>
                <div class="header-actions">
                    <!-- Privacy Toggle -->
                    <div id="privacyToggleContainer" class="hidden">
                        <button id="privacyToggle" class="btn-privacy">
                            <span class="privacy-icon">üõ°Ô∏è</span>
                            <span class="privacy-label">Privacy Mode</span>
                        </button>
                    </div>
                    <button id="connectWallet" class="btn btn-primary">
                        <span class="btn-icon">‚ö°</span>
                        Connect Wallet
                    </button>
                    <div id="walletInfo" class="wallet-info hidden">
                        <span class="wallet-address"></span>
                        <span class="wallet-balance"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-container">
            <!-- Sidebar - Document Tree -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h3>Documentation</h3>
                    <button id="refreshDocs" class="btn-icon" title="Refresh">‚Üª</button>
                </div>
                <nav id="docTree" class="doc-tree">
                    <!-- Dynamically populated -->
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Document Viewer -->
                <div id="documentViewer" class="document-viewer">
                    <div class="doc-toolbar">
                        <div class="doc-breadcrumbs">
                            <span class="breadcrumb-item">docs</span>
                            <span class="breadcrumb-separator">/</span>
                            <span class="breadcrumb-item">finallica</span>
                            <span class="breadcrumb-separator">/</span>
                            <span id="currentDoc" class="breadcrumb-item active">README.md</span>
                        </div>
                        <div class="doc-actions">
                            <button id="editDoc" class="btn btn-secondary">
                                <span class="btn-icon">‚úé</span>
                                Edit
                            </button>
                            <button id="proposeChange" class="btn btn-primary">
                                <span class="btn-icon">‚§ß</span>
                                Propose Change
                            </button>
                            <button id="viewHistory" class="btn btn-secondary">
                                <span class="btn-icon">‚ó∑</span>
                                History
                            </button>
                        </div>
                    </div>
                    <div id="docContent" class="doc-content">
                        <!-- Document content rendered here -->
                    </div>
                </div>

                <!-- Editor Panel (Hidden by default) -->
                <div id="editorPanel" class="editor-panel hidden">
                    <div class="editor-toolbar">
                        <h3 id="editorTitle">Edit Document</h3>
                        <div class="editor-actions">
                            <button id="previewChanges" class="btn btn-secondary">Preview</button>
                            <button id="saveEdit" class="btn btn-primary">Save</button>
                            <button id="cancelEdit" class="btn btn-secondary">Cancel</button>
                        </div>
                    </div>
                    <textarea id="docEditor" class="doc-editor" spellcheck="false"></textarea>
                    <div id="editPreview" class="edit-preview hidden"></div>
                </div>

                <!-- Proposals Panel -->
                <div id="proposalsPanel" class="proposals-panel hidden">
                    <div class="panel-header">
                        <h3>Active Proposals</h3>
                        <button id="newProposal" class="btn btn-primary">+ New Proposal</button>
                    </div>
                    <div id="proposalsList" class="proposals-list">
                        <!-- Dynamically populated -->
                    </div>
                </div>

                <!-- Consensus View -->
                <div id="consensusPanel" class="consensus-panel hidden">
                    <div class="panel-header">
                        <h3>Consensus State</h3>
                        <div class="consensus-stats">
                            <span class="stat">Block: <span id="currentBlock">0</span></span>
                            <span class="stat">Epoch: <span id="currentEpoch">0</span></span>
                            <span class="stat">Votes: <span id="totalVotes">0</span></span>
                        </div>
                    </div>
                    <div id="consensusContent" class="consensus-content">
                        <!-- Consensus data rendered here -->
                    </div>
                </div>
            </main>

            <!-- Right Panel - AI Chat & Voting -->
            <aside class="right-panel">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" data-tab="ai-chat">
                        <span class="tab-icon">ü§ñ</span>
                        AI Chat
                    </button>
                    <button class="tab-btn" data-tab="proposals">
                        <span class="tab-icon">‚öñÔ∏è</span>
                        Proposals
                        <span id="pendingCount" class="badge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="consensus">
                        <span class="tab-icon">‚õìÔ∏è</span>
                        Consensus
                    </button>
                    <button class="tab-btn" data-tab="activity">
                        <span class="tab-icon">‚ñ£</span>
                        Activity
                    </button>
                    <button class="tab-btn" data-tab="privacy">
                        <span class="tab-icon">üõ°Ô∏è</span>
                        Privacy
                    </button>
                    <button class="tab-btn" data-tab="suggestions">
                        <span class="tab-icon">üí°</span>
                        Suggestions
                    </button>
                </div>

                <!-- Tab Contents -->
                <div class="tab-content">
                    <!-- AI Chat Tab -->
                    <div id="ai-chat" class="tab-pane active">
                        <div class="chat-header">
                            <h3>AI Assistant</h3>
                            <div class="chat-header-controls">
                                <div id="aiModelSelector" class="ai-model-selector">
                                    <!-- Provider and model selectors will be rendered here -->
                                </div>
                                <button id="aiSettingsBtn" class="btn-icon-small" title="AI Settings">
                                    <span>‚öôÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div id="chatMessages" class="chat-messages">
                            <div class="chat-message system">
                                <div class="message-content">
                                    Welcome to Finallica AI Assistant. Ask questions about the architecture, protocol, or any aspect of the system.
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <textarea id="chatInput" class="chat-input" placeholder="Ask about Finallica..." rows="3"></textarea>
                            <div class="chat-actions">
                                <button id="sendChat" class="btn btn-primary">Send</button>
                                <button id="clearChat" class="btn btn-secondary">Clear</button>
                            </div>
                        </div>
                    </div>

                    <!-- Proposals Tab -->
                    <div id="proposals" class="tab-pane">
                        <div id="proposalsSummary" class="proposals-summary">
                            <!-- Summary cards -->
                        </div>
                        <div id="proposalsDetail" class="proposals-detail">
                            <!-- Detailed list -->
                        </div>
                    </div>

                    <!-- Consensus Tab -->
                    <div id="consensus" class="tab-pane">
                        <div class="consensus-overview">
                            <div class="consensus-metric">
                                <span class="metric-label">Total Stake</span>
                                <span class="metric-value" id="totalStake">0 BLF</span>
                            </div>
                            <div class="consensus-metric">
                                <span class="metric-label">Quorum</span>
                                <span class="metric-value" id="quorumStatus">Not Reached</span>
                            </div>
                            <div class="consensus-metric">
                                <span class="metric-label">Approval Rate</span>
                                <span class="metric-value" id="approvalRate">0%</span>
                            </div>
                        </div>
                        <div id="consensusList" class="consensus-list">
                            <!-- Voting items -->
                        </div>
                    </div>

                    <!-- Activity Tab -->
                    <div id="activity" class="tab-pane">
                        <div id="activityFeed" class="activity-feed">
                            <!-- Activity timeline -->
                        </div>
                    </div>

                    <!-- Privacy Tab -->
                    <div id="privacy" class="tab-pane">
                        <!-- Privacy Status -->
                        <div class="privacy-status-bar">
                            <div class="privacy-status">
                                <span class="privacy-status-dot"></span>
                                <span id="privacyStatusText">Privacy Service: Checking...</span>
                            </div>
                        </div>

                        <!-- Privacy Controls Panel -->
                        <div id="privacyControls" class="privacy-panel hidden">
                            <h3>üõ°Ô∏è Privacy Controls</h3>

                            <!-- Private Deposit Section -->
                            <div class="privacy-section">
                                <h4>Private Deposit</h4>
                                <p class="privacy-warning">
                                    Deposit funds into the privacy mixer. Your deposit will be mixed with others
                                    to break the on-chain link between sender and recipient.
                                </p>

                                <div class="form-group">
                                    <label>Token</label>
                                    <select id="privacyToken">
                                        <option value="ETH">ETH</option>
                                        <option value="BLF">BLF</option>
                                        <option value="USDC">USDC</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>Amount</label>
                                    <select id="privacyAmount">
                                        <option value="0.1">0.1 ETH</option>
                                        <option value="1">1 ETH</option>
                                        <option value="10">10 ETH</option>
                                        <option value="100">100 BLF</option>
                                        <option value="1000">1000 BLF</option>
                                        <option value="10000">10000 BLF</option>
                                    </select>
                                </div>

                                <div class="privacy-actions">
                                    <button id="generatePrivacyNote" class="btn btn-secondary">
                                        <span class="btn-icon">üîê</span>
                                        Generate Note
                                    </button>
                                </div>

                                <div class="form-group" style="margin-top: 1rem;">
                                    <label>Your Note (save this securely!)</label>
                                    <textarea id="privacyNoteDisplay" readonly rows="3" placeholder="Click 'Generate Note' to create a privacy deposit note..."></textarea>
                                    <div id="privacyFeeEstimate" style="margin-top: 0.5rem;"></div>
                                </div>

                                <div class="privacy-actions">
                                    <button id="executePrivateDeposit" class="btn btn-primary">
                                        <span class="btn-icon">üí∞</span>
                                        Deposit to Privacy Pool
                                    </button>
                                    <button id="copyPrivacyNote" class="btn btn-secondary">
                                        <span class="btn-icon">üìã</span>
                                        Copy Note
                                    </button>
                                    <button id="saveNoteLocally" class="btn btn-secondary">
                                        <span class="btn-icon">üíæ</span>
                                        Save Note
                                    </button>
                                </div>
                            </div>

                            <div class="privacy-divider"></div>

                            <!-- Note Validation Section -->
                            <div class="privacy-section">
                                <h4>Validate Note</h4>
                                <p class="privacy-warning">
                                    Validate an existing privacy note to check if it's valid and view its details.
                                </p>

                                <div class="form-group">
                                    <label>Paste your note here</label>
                                    <input type="text" id="validateNoteInput" placeholder="tornado-ETH-0.1-..." />
                                </div>

                                <div id="noteValidationResult" style="display: none;"></div>

                                <div class="privacy-actions">
                                    <button id="validatePrivacyNote" class="btn btn-secondary">Validate Note</button>
                                </div>
                            </div>

                            <div class="privacy-divider"></div>

                            <!-- Saved Notes Section -->
                            <div class="privacy-section">
                                <h4>Saved Notes</h4>
                                <div id="savedNotesList" style="margin-top: 0.5rem;">
                                    <p class="text-muted">No saved notes</p>
                                </div>
                            </div>

                            <!-- Privacy Best Practices -->
                            <div class="privacy-info">
                                <h5>Privacy Best Practices:</h5>
                                <ul>
                                    <li>Wait at least a few hours between deposit and withdrawal</li>
                                    <li>Use a fresh address for withdrawals</li>
                                    <li>Don't deposit and withdraw predictable amounts</li>
                                    <li>Save your note securely - it's required to withdraw</li>
                                    <li>Never share your note with anyone</li>
                                </ul>
                            </div>

                            <!-- Privacy Disclaimer -->
                            <div class="privacy-disclaimer">
                                <strong>Privacy Disclaimer:</strong>
                                <ul>
                                    <li>Tornado Cash sanctions were lifted in March 2025, but regulations vary by jurisdiction</li>
                                    <li>Some exchanges may flag addresses that interact with mixers</li>
                                    <li>You are responsible for compliance with your local laws</li>
                                    <li>This is an optional privacy feature - nothing is mandatory</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Suggestions Tab -->
                    <div id="suggestions" class="tab-pane">
                        <div class="suggestions-header">
                            <h3>üí° Repository Suggestions</h3>
                            <div class="suggestions-actions">
                                <button id="refreshSuggestions" class="btn-icon-small" title="Refresh">‚Üª</button>
                                <button id="suggestionsSettings" class="btn-icon-small" title="Settings">‚öôÔ∏è</button>
                            </div>
                        </div>
                        <div class="suggestions-context">
                            <p class="suggestions-subtitle">Based on your current document and session activity</p>
                        </div>
                        <div id="suggestionsList" class="suggestions-list">
                            <div class="suggestions-loading">
                                <div class="spinner"></div>
                                <p>Analyzing your session...</p>
                            </div>
                        </div>
                        <div class="suggestions-footer">
                            <button id="dismissAllSuggestions" class="btn btn-secondary btn-small">Dismiss All</button>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Proposal Modal -->
    <div id="proposalModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Proposal</h2>
                <button id="closeModal" class="btn-close">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="proposalForm">
                    <div class="form-group">
                        <label for="proposalTitle">Title</label>
                        <input type="text" id="proposalTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proposalType">Type</label>
                        <select id="proposalType" class="form-control">
                            <option value="document_edit">Document Edit</option>
                            <option value="new_section">New Section</option>
                            <option value="protocol_change">Protocol Change</option>
                            <option value="parameter_update">Parameter Update</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="proposalDoc">Document</label>
                        <select id="proposalDoc" class="form-control">
                            <!-- Populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="proposalDiff">Changes (Diff Format)</label>
                        <textarea id="proposalDiff" class="form-control" rows="10" placeholder="--- a/file.md&#10;+++ b/file.md&#10;@@ -1,1 +1,2 @@&#10;- old line&#10;+ new line"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="proposalRationale">Rationale</label>
                        <textarea id="proposalRationale" class="form-control" rows="4" placeholder="Explain why this change should be made..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="proposalStake">Stake Amount (BLF)</label>
                        <input type="number" id="proposalStake" class="form-control" min="1000" value="1000" required>
                        <small class="form-text">Minimum 1000 BLF stake required. This stake is locked until proposal is resolved.</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="submitProposal" class="btn btn-primary">Submit Proposal</button>
                <button id="cancelProposal" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Voting Modal -->
    <div id="votingModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Vote on Proposal</h2>
                <button id="closeVotingModal" class="btn-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="votingProposalDetails" class="voting-details">
                    <!-- Proposal details -->
                </div>
                <div class="voting-options">
                    <button id="voteFor" class="btn btn-success btn-large">
                        <span class="btn-icon">‚úî</span>
                        Vote For
                    </button>
                    <button id="voteAgainst" class="btn btn-danger btn-large">
                        <span class="btn-icon">‚úñ</span>
                        Vote Against
                    </button>
                    <button id="voteAbstain" class="btn btn-secondary btn-large">
                        <span class="btn-icon">‚äù</span>
                        Abstain
                    </button>
                </div>
                <div class="voting-sliders">
                    <div class="slider-group">
                        <label>Stake Weight: <span id="stakeWeightValue">100</span>%</label>
                        <input type="range" id="stakeWeight" min="1" max="100" value="100">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Settings Modal -->
    <div id="aiSettingsModal" class="modal hidden">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>AI Provider Settings</h2>
                <button id="closeAiSettingsModal" class="btn-close">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="ai-settings-info">
                    <p>Configure your own API keys to use AI providers. Keys are stored locally in your browser and never sent to our servers.</p>
                </div>

                <!-- Provider Tabs -->
                <div class="provider-tabs">
                    <button class="provider-tab active" data-provider="anthropic">
                        <span class="provider-logo">üü£</span>
                        Anthropic
                    </button>
                    <button class="provider-tab" data-provider="openai">
                        <span class="provider-logo">üîµ</span>
                        OpenAI
                    </button>
                    <button class="provider-tab" data-provider="openrouter">
                        <span class="provider-logo">üü¢</span>
                        OpenRouter
                    </button>
                    <button class="provider-tab" data-provider="groq">
                        <span class="provider-logo">‚ö°</span>
                        Groq
                    </button>
                </div>

                <!-- Provider Configuration Panels -->
                <div class="provider-panels">
                    <!-- Anthropic Panel -->
                    <div id="panel-anthropic" class="provider-panel active">
                        <h4>Anthropic Claude API</h4>
                        <p class="provider-desc">Get your API key from <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></p>

                        <div class="form-group">
                            <label for="anthropicApiKey">API Key</label>
                            <input type="password" id="anthropicApiKey" class="form-control" placeholder="sk-ant-xxxxx">
                        </div>

                        <div class="form-group">
                            <label for="anthropicModel">Default Model</label>
                            <select id="anthropicModel" class="form-control">
                                <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (New)</option>
                                <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                                <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                                <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                            </select>
                        </div>

                        <div class="api-key-actions">
                            <button class="btn btn-secondary btn-sm" onclick="testApiKey('anthropic')">Test Key</button>
                            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('anthropic')">Save Key</button>
                            <button class="btn btn-danger btn-sm" onclick="clearApiKey('anthropic')">Clear Key</button>
                        </div>

                        <div id="anthropicKeyStatus" class="key-status"></div>
                    </div>

                    <!-- OpenAI Panel -->
                    <div id="panel-openai" class="provider-panel">
                        <h4>OpenAI API</h4>
                        <p class="provider-desc">Get your API key from <a href="https://platform.openai.com/api-keys" target="_blank">platform.openai.com</a></p>

                        <div class="form-group">
                            <label for="openaiApiKey">API Key</label>
                            <input type="password" id="openaiApiKey" class="form-control" placeholder="sk-proj-xxxxx">
                        </div>

                        <div class="form-group">
                            <label for="openaiModel">Default Model</label>
                            <select id="openaiModel" class="form-control">
                                <option value="gpt-4o">GPT-4o</option>
                                <option value="gpt-4o-mini">GPT-4o Mini</option>
                                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            </select>
                        </div>

                        <div class="api-key-actions">
                            <button class="btn btn-secondary btn-sm" onclick="testApiKey('openai')">Test Key</button>
                            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('openai')">Save Key</button>
                            <button class="btn btn-danger btn-sm" onclick="clearApiKey('openai')">Clear Key</button>
                        </div>

                        <div id="openaiKeyStatus" class="key-status"></div>
                    </div>

                    <!-- OpenRouter Panel -->
                    <div id="panel-openrouter" class="provider-panel">
                        <h4>OpenRouter API</h4>
                        <p class="provider-desc">Get your API key from <a href="https://openrouter.ai/keys" target="_blank">openrouter.ai</a></p>

                        <div class="form-group">
                            <label for="openrouterApiKey">API Key</label>
                            <input type="password" id="openrouterApiKey" class="form-control" placeholder="sk-or-xxxxx">
                        </div>

                        <div class="form-group">
                            <label for="openrouterModel">Default Model</label>
                            <select id="openrouterModel" class="form-control">
                                <option value="anthropic/claude-sonnet-4">Claude Sonnet 4</option>
                                <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                                <option value="openai/gpt-4o">GPT-4o</option>
                                <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option>
                                <option value="meta-llama/llama-3.1-70b-instruct">Llama 3.1 70B</option>
                            </select>
                        </div>

                        <div class="api-key-actions">
                            <button class="btn btn-secondary btn-sm" onclick="testApiKey('openrouter')">Test Key</button>
                            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('openrouter')">Save Key</button>
                            <button class="btn btn-danger btn-sm" onclick="clearApiKey('openrouter')">Clear Key</button>
                        </div>

                        <div id="openrouterKeyStatus" class="key-status"></div>
                    </div>

                    <!-- Groq Panel -->
                    <div id="panel-groq" class="provider-panel">
                        <h4>Groq API</h4>
                        <p class="provider-desc">Get your free API key from <a href="https://console.groq.com/keys" target="_blank">console.groq.com</a></p>

                        <div class="form-group">
                            <label for="groqApiKey">API Key</label>
                            <input type="password" id="groqApiKey" class="form-control" placeholder="gsk_xxxxx">
                        </div>

                        <div class="form-group">
                            <label for="groqModel">Default Model</label>
                            <select id="groqModel" class="form-control">
                                <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
                                <option value="llama-3.1-70b-versatile">Llama 3.1 70B</option>
                                <option value="mixtral-8x7b-32768">Mixtral 8x7b</option>
                                <option value="gemma2-9b-it">Gemma 2 9B</option>
                            </select>
                        </div>

                        <div class="api-key-actions">
                            <button class="btn btn-secondary btn-sm" onclick="testApiKey('groq')">Test Key</button>
                            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('groq')">Save Key</button>
                            <button class="btn btn-danger btn-sm" onclick="clearApiKey('groq')">Clear Key</button>
                        </div>

                        <div id="groqKeyStatus" class="key-status"></div>
                    </div>
                </div>

                <!-- Stored Keys Summary -->
                <div class="stored-keys-summary">
                    <h4>Your Stored Keys</h4>
                    <div id="storedKeysList" class="stored-keys-list">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="closeAiSettingsFooter" class="btn btn-primary">Done</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
